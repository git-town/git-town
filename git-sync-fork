#!/bin/bash
source "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/helpers/helpers.sh"


function build_command_list {
  if [ "$initial_open_changes" = true ]; then
    add_to_command_list "stash_open_changes"
  fi

  add_to_command_list "checkout_main_branch"
  add_to_command_list "fetch_upstream"
  add_to_command_list "rebase upstream/$main_branch_name"
  add_to_command_list "push"
  add_to_command_list "checkout $initial_branch_name"

  if [ "$initial_open_changes" = true ]; then
    add_to_command_list "restore_open_changes"
  fi
}


function ensure_has_upstream {
  if [ "$(git remote -v | grep -c 'upstream')" == 0 ]; then
    echo_error_header
    echo_error "Please add a remote 'upstream'"
    exit_with_error
  fi
}


function ensure_preconditions {
  ensure_has_upstream
}


run "$@"
