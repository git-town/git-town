#!/bin/bash
source "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/helpers/helpers.sh"


function add_steps {
  if [ "$initial_open_changes" = true ]; then
    add_step "stash_open_changes"
  fi

  add_step "checkout_main_branch"
  add_step "fetch"
  add_step "rebase_tracking_branch"
  add_step "push"
  add_step "create_and_checkout_feature_branch '$target_branch_name'"

  if [ "$initial_open_changes" = true ]; then
    add_step "restore_open_changes"
  fi
}


function ensure_has_target_branch {
  if [ -z "$target_branch_name" ]; then
    echo_error_header
    echo_error "No branch name provided."
    exit_with_error
  fi
}


function preconditions {
  target_branch_name=$1
  ensure_has_target_branch
  ensure_does_not_have_branch "$target_branch_name"
}


run "$@"
