machine:
  environment:

    # CircleCI supports up to 32 processors,
    # but 8 processors yields the fastest results
    PARALLEL_TEST_PROCESSORS: 8

    PATH: $HOME/.cabal/bin/:$PATH


# checkout:
#
  # override:
  #   - git clone --depth=2 --branch=$CIRCLE_BRANCH https://github.com/Originate/git-town.git /home/ubuntu/.go_workspace/src/github.com/Originate/gt
  #   - cd /home/ubuntu/.go_workspace/src/github.com/Originate/gt
  #   - git checkout $CIRCLE_SHA1


dependencies:

  # Cache ShellCheck for subsequent builds
  cache_directories:
    - "~/.cabal"

  override:
    - mkdir -p /home/ubuntu/.go_workspace/src/github.com/Originate
    - cp -r /home/ubuntu/git-town /home/ubuntu/.go_workspace/src/github.com/Originate/gt
    - cd /home/ubuntu/.go_workspace/src/github.com/Originate/gt && go install
    - echo $PATH
    - which gt
    - gt version
    - cd /home/ubuntu/git-town && bundle install

  post:
    - bin/circleci-install-shellcheck

notify:
  webhooks:
    - url: https://xrayci.herokuapp.com/webhooks/builds


test:
  override:
    - bundle exec rake lint:bash
    - bundle exec rake lint:ruby
    - bundle exec rake lint:cucumber
    - bundle exec rake test
