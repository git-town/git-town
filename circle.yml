machine:
  environment:

    # CircleCI supports up to 32 processors,
    # but 8 processors yields the fastest results
    PARALLEL_TEST_PROCESSORS: 8

    PATH: $HOME/.cabal/bin/:$PATH
    GO_PROJECT: "$HOME/.go_workspace/src/github.com/Originate/git-town"


dependencies:

  # Cache ShellCheck for subsequent builds
  cache_directories:
    - "~/.cabal"

  pre:
    - rm -rf "$GO_PROJECT"
    - mkdir -p "$(dirname "$GO_PROJECT")"
    - mv "$HOME/git-town" "$GO_PROJECT"
    - ln -s "$GO_PROJECT" "$HOME/git-town"

  override:
    - bin/setup
    - bin/circleci-install-shellcheck
    - bundle install


notify:
  webhooks:
    - url: https://xrayci.herokuapp.com/webhooks/builds


test:
  override:
    - bundle exec rake lint:bash
    - bin/lint_go
    - bin/unit_test_go
    - bundle exec rake lint:ruby
    - bundle exec rake lint:cucumber
    - bundle exec rake test
